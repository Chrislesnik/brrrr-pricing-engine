/* Import shared UI styles */
@import "@repo/ui/globals.css";

/* Liveblocks default + dark-mode styles */
@import "@liveblocks/react-ui/styles.css";
@import "@liveblocks/react-ui/styles/dark/attributes.css";
@import "@liveblocks/react-tiptap/styles.css";

/* ── App-level token extensions ───────────────────────────────────────────── */
/* These supplement the shared design tokens in @repo/ui/globals.css.        */

:root {
  /* Neutral (hue-0, 0% saturation) canvas background for the email editor.
     Kept separate from --muted which carries a 240° blue hue tint.          */
  --canvas-background: 0 0% 93%;
}

.dark {
  --canvas-background: 0 0% 11%;
}

/* App-specific styles can be added below */

/* -----------------------------------------------------------------------
   Liveblocks Comments — dark-mode overrides
   Strip blocky backgrounds and make the UI feel native / minimal
   ----------------------------------------------------------------------- */

/* Map Liveblocks accent to the app's primary color */
.lb-root {
  --lb-accent: hsl(var(--primary));
  --lb-accent-foreground: hsl(var(--primary-foreground));
  --lb-dynamic-background: hsl(var(--background));
  --lb-foreground: hsl(var(--foreground));
}

/* Composer send / submit button — use app primary, not Liveblocks blue */
.lb-composer-action[type="submit"],
.lb-button[type="submit"],
button.lb-composer-action:last-child,
.lb-composer [data-submit],
.lb-icon-button[type="submit"] {
  background: hsl(var(--primary)) !important;
  color: hsl(var(--primary-foreground)) !important;
  border: none !important;
  border-radius: 0.5rem !important;
}

.lb-composer-action[type="submit"]:hover,
.lb-button[type="submit"]:hover,
button.lb-composer-action:last-child:hover,
.lb-composer [data-submit]:hover,
.lb-icon-button[type="submit"]:hover {
  background: hsl(var(--primary) / 0.8) !important;
}

/* Any remaining accent-colored elements — links, active states */
.lb-accent,
.lb-comment a,
.lb-thread a {
  color: hsl(var(--primary)) !important;
}

.lb-comment,
.lb-thread {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

/* Remove card-like background from individual comment containers */
.lb-comment-content {
  background: transparent !important;
}

/* Clean up the composer — no heavy box-shadow or background block */
.lb-composer {
  background: hsl(var(--muted) / 0.3) !important;
  border: 1px solid hsl(var(--border)) !important;
  box-shadow: none !important;
  border-radius: 0.75rem !important;
}

.lb-composer:focus-within {
  border-color: hsl(var(--ring)) !important;
  background: hsl(var(--muted) / 0.5) !important;
}

/* Composer editor placeholder */
.lb-composer-editor [data-placeholder]::before {
  color: hsl(var(--muted-foreground)) !important;
}

/* Reaction badges — subtle, not blocky */
.lb-comment-reaction {
  background: hsl(var(--muted) / 0.4) !important;
  border: 1px solid hsl(var(--border) / 0.5) !important;
  border-radius: 9999px !important;
}

.lb-comment-reaction:hover {
  background: hsl(var(--muted) / 0.7) !important;
}

.lb-comment-reaction[data-active] {
  background: hsl(var(--primary) / 0.15) !important;
  border-color: hsl(var(--primary) / 0.4) !important;
}

/* Toolbar / action buttons — keep them subtle */
.lb-comment-actions,
.lb-toolbar {
  background: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 0.5rem !important;
  box-shadow: 0 2px 8px hsl(0 0% 0% / 0.25) !important;
}

/* Thread component in detail view — no extra card styling */
.lb-thread-comments {
  background: transparent !important;
}

/* Thread reply composer — match the spacing of the main chat composer
   wrapper (px-3 py-3 = 0.75rem). Adds margin around the form so the
   composer box has the same distance from the panel walls. */
.lb-thread-composer {
  margin: 0.75rem !important;
  margin-top: 2px !important;
}

/* Composer formatting toolbar */
.lb-composer-toolbar {
  background: transparent !important;
  border-top: 1px solid hsl(var(--border) / 0.5) !important;
}

/* Composer submit button area */
.lb-composer-footer {
  background: transparent !important;
}

/* Keep submit button visually active and clickable when the composer has
   attachments, even if the text editor is empty. The JS hook in
   comments-panel.tsx handles the actual submission logic. */
.lb-composer:has(.lb-composer-attachment) button[type="submit"]:disabled,
.lb-composer:has(.lb-composer-attachments) button[type="submit"]:disabled,
.lb-composer-form:has(.lb-composer-attachment) button[type="submit"]:disabled,
.lb-composer-form:has(.lb-composer-attachments) button[type="submit"]:disabled {
  opacity: 1 !important;
  pointer-events: auto !important;
  cursor: pointer !important;
  background: hsl(var(--primary)) !important;
  color: hsl(var(--primary-foreground)) !important;
}

/* Hide the empty text body area in comments that only have attachments */
.lb-comment-body:empty,
.lb-comment-content > .lb-comment-body:has(> p:only-child:empty),
.lb-comment-content > .lb-comment-body:has(> :only-child:not(.lb-attachments)):empty {
  display: none !important;
}

/* Also collapse the body when it only contains a zero-width space (injected
   by our attachment-only submission workaround) */
.lb-comment-body > p:only-child:empty {
  display: none !important;
}

/* -----------------------------------------------------------------------
   Liveblocks Mentions — popover, suggestion items, avatars, mention pills.
   Selectors are doubled (.lb-root .lb-*) to beat built-in specificity.
   ----------------------------------------------------------------------- */

/* ── Floating suggestions container ─────────────────────────────────── */
.lb-root .lb-composer-suggestions,
.lb-root .lb-composer-mention-suggestions,
.lb-composer-suggestions[class],
.lb-composer-mention-suggestions[class] {
  z-index: 9999 !important;
  min-width: 240px !important;
  max-width: 300px !important;
  max-height: 260px !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  background: hsl(var(--popover)) !important;
  color: hsl(var(--popover-foreground)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 0.5rem !important;
  box-shadow:
    0 0 0 1px hsl(var(--border) / 0.5),
    0 4px 16px hsl(0 0% 0% / 0.35),
    0 12px 32px hsl(0 0% 0% / 0.2) !important;
  padding: 4px !important;
  -webkit-backdrop-filter: blur(12px) !important;
  backdrop-filter: blur(12px) !important;
}

/* Inner list — reset so container handles spacing */
.lb-root .lb-composer-suggestions-list,
.lb-composer-suggestions-list[class] {
  list-style: none !important;
  margin: 0 !important;
  padding: 0 !important;
  display: flex !important;
  flex-direction: column !important;
  gap: 2px !important;
}

/* ── Individual suggestion row ──────────────────────────────────────── */
.lb-root .lb-composer-suggestions-list-item,
.lb-root .lb-composer-mention-suggestion,
.lb-composer-suggestions-list-item[class],
.lb-composer-mention-suggestion[class] {
  display: flex !important;
  align-items: center !important;
  gap: 0.625rem !important;
  padding: 8px 10px !important;
  border-radius: 0.375rem !important;
  font-size: 0.8125rem !important;
  line-height: 1.35 !important;
  color: hsl(var(--foreground)) !important;
  cursor: pointer !important;
  transition: background 0.12s ease !important;
  background: transparent !important;
}

.lb-root .lb-composer-suggestions-list-item:hover,
.lb-root .lb-composer-suggestions-list-item[data-selected],
.lb-root .lb-composer-mention-suggestion:hover,
.lb-root .lb-composer-mention-suggestion[data-selected],
.lb-composer-suggestions-list-item[data-selected],
.lb-composer-mention-suggestion[data-selected] {
  background: hsl(var(--accent)) !important;
  color: hsl(var(--accent-foreground)) !important;
}

/* ── Avatar inside suggestion rows ──────────────────────────────────── */
.lb-root .lb-composer-mention-suggestion-avatar,
.lb-root .lb-composer-suggestions-list-item .lb-avatar,
.lb-composer-mention-suggestion-avatar[class],
.lb-composer-suggestions-list-item .lb-avatar[class] {
  width: 26px !important;
  height: 26px !important;
  min-width: 26px !important;
  border-radius: 50% !important;
  font-size: 10px !important;
  font-weight: 600 !important;
  flex-shrink: 0 !important;
}

/* Avatar fallback initials */
.lb-root .lb-composer-mention-suggestion-avatar .lb-avatar-fallback,
.lb-root .lb-composer-suggestions-list-item .lb-avatar .lb-avatar-fallback {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 100% !important;
  height: 100% !important;
  font-size: 10px !important;
  font-weight: 600 !important;
}

/* ── Group description ──────────────────────────────────────────────── */
.lb-root .lb-composer-mention-suggestion-group-description,
.lb-composer-mention-suggestion-group-description[class] {
  font-size: 0.6875rem !important;
  color: hsl(var(--muted-foreground)) !important;
  padding: 6px 10px 2px !important;
  text-transform: uppercase !important;
  letter-spacing: 0.05em !important;
  font-weight: 600 !important;
}

/* ── Mention pills inside editor & rendered comments ────────────────── */
.lb-root .lb-mention,
.lb-root .lb-composer-mention,
.lb-mention[class],
.lb-composer-mention[class] {
  background: hsl(var(--primary) / 0.12) !important;
  color: hsl(var(--primary)) !important;
  border-radius: 0.25rem !important;
  padding: 0.1em 0.3em !important;
  font-weight: 500 !important;
  font-size: inherit !important;
}

.lb-root .lb-mention-symbol,
.lb-mention-symbol[class] {
  opacity: 0.7 !important;
}

/* ── GrapesJS left panel: overflow + z-index fixes are applied via
   JavaScript in studio-editor-wrapper.tsx onReady, because the SDK's
   internal Tailwind utilities and inline styles defeat external CSS. ────── */

